--- cable_air.F90	2011-10-19 13:47:16.000000000 +1100
+++ cable_air.F90.WORKS	2011-10-18 17:31:44.000000000 +1100
@@ -1,4 +1,4 @@
-!jhan:include knode capability - and how much can i keep? test this on vayu with UM aswell
+
 MODULE air_module
    use define_dimensions, only : mp, r_1
    IMPLICIT NONE
@@ -7,6 +7,24 @@
 
    character(len=10) :: filename = "air"
 
+   type air_in
+      real,dimension(:), pointer     :: &
+         met_tvair, &
+         met_pmb
+   end type air_in
+
+   type air_out
+      real, dimension(:), pointer     :: &
+         air_cmolar, &
+         air_rho, &
+         air_rlam, &
+         air_dsatdk, &
+         air_epsi, & 
+         air_visc, & 
+         air_psyc 
+   end type air_out
+
+
 CONTAINS
 
 
@@ -15,7 +33,7 @@
       use define_dimensions, only : mp, r_1
       use cable_common_module, only : cable_user
       use cable_diag_module, only : cable_stat
-      use cable_data_module, only : const, air_in, air_out
+      use cable_data_module, only : const
       implicit none
       TYPE (air_type), INTENT(INOUT) :: air ! air_type variables
       TYPE (met_type), INTENT(IN)  :: met ! meteorological variables
@@ -34,8 +52,8 @@
       o%air_dsatdk   => air%dsatdk       
       
       !jhan:atleast interface this to include o 
-      call dump_air(i)
-      !call read_air(i)
+      !call dump_air(i)
+      call read_air(i, mp)
 
       call new_define_air(i,o)
 
@@ -48,7 +66,7 @@
    subroutine new_define_air(i,o)
       use cable_common_module, only : cable_user
       use cable_diag_module, only : cable_stat
-      use cable_data_module, only : const, air_in, air_out
+      use cable_data_module, only : const
       use define_dimensions, only : mp, r_1
       implicit none
       type (air_in), intent(in) :: i
@@ -121,7 +139,6 @@
 
 
    subroutine dump_air(i)
-      use cable_data_module, only : air_in
       implicit none
       type (air_in), intent(in) :: i
       integer :: gopenstatus
@@ -129,7 +146,7 @@
       open(unit=713940,file=trim(filename)//'.bin',status="unknown",action="write", &
          iostat=gopenstatus, form="unformatted", position='append' )
       if(gopenstatus==0) then
-         write (713940) i%met_tvair, i%met_pmb 
+            write (713940) i%met_tvair*.9, i%met_pmb*.9 
       else
          write (*,*) filename//'.bin',' NOT open for write. Error'
       endif
@@ -140,24 +157,27 @@
 
 
 
-   subroutine read_air(i)
-      use cable_data_module, only : air_in
+   subroutine read_air(i, mp)
       implicit none
       type (air_in), intent(inout) :: i
+      integer, intent(in) :: mp
       integer,save :: gopenstatus
       logical :: lopen
+      real, dimension(mp) :: tvair, pmb
        
       inquire(unit=813940,opened=lopen)
       if (.NOT. lopen) &
          open(unit=813940,file=trim(filename)//'.bin',status="unknown",action="read", &
             iostat=gopenstatus, form="unformatted" )
          if(gopenstatus==0) then
-            read(813940) i%met_tvair, i%met_pmb 
+            read(813940) tvair, pmb 
          else
             write (*,*) filename//'.bin',' NOT open for READ. Error'
          endif
+         i%met_tvair    = tvair 
+         i%met_pmb      = pmb 
 
-         !DONT close(813940) to maintain position
+         !close(813940)
       
       return
    end subroutine read_air
