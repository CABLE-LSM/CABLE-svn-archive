## this Makefile is specific to the UM in the respect that it builds UM interface routines,
## which may also require some um headers (see below UMINCLUDES)

PROG = cable
PROGi90 = cablei90

#vayu
FC = ifort                    # compiler on vayu, cherax, shine
#zjlnik
#FC = gfortran                    
#FC = gfortran  -ffree-line-length-132

#vayu.nci.org.au
NCDIR = /apps/netcdf/3.6.3/lib/Intel
NCMOD = /apps/netcdf/3.6.3/include/Intel/netcdf.mod
# shine-cl
#NCDIR = /usr/local/intel/lib/            # netcdf library address on shine-cl
#NCMOD = /usr/local/intel/include/netcdf.mod                    # on shine-cl
#zjlnik
#NCDIR = /usr/local/lib/            # netcdf library address on zjlmik 
##NCMOD = /usr/local/include/NETCDF.mod
#NCMOD = /usr/local/include/ncdf/ #netcdf.mod


#ifort compiler options
FFLAGS = -O0 -traceback -g -fp-model precise -ftz -fpe0 -I$(NCMOD) 

#gfortran compiler options
#FFLAGS = -O0 -x f95-cpp-input -v -g3 -I$(NCMOD) 
#FFLAGS = -O0 -x f95-cpp-input -I$(NCMOD) 

FCOMMON = ../../core/src/common/
FDIAG = ../../core/src/common/read
FSCIENCE= ../../core/src/science/
FDRIVERS = ../../offline/src/
FCASA    = ../../core/pkg/CASA/


$(PROG): $(FDRIVERS)cable_driver.f90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_define_dimensions.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_math_constants.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_other_constants.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_photosynthetic_constants.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_physical_constants.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_define_types.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_data.F90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_iovars.F90
	$(FC) $(FFLAGS) -o cable_common_module.o -c $(FCOMMON)cable_common.F90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_abort.f90
	$(FC) $(FFLAGS) -c $(FCASA)casa_variable.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_parameters.f90
	$(FC) $(FFLAGS) -c $(FCOMMON)cable_diag.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_soilsnow.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_air.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_albedo.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_radiation.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_roughness.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_carbon.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_canopy.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)cable_cbm.F90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_checks.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_read.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_initialise.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_input.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_write.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_output.f90
	$(FC) $(FFLAGS) -c $(FCASA)casa_cnp.f90
	$(FC) $(FFLAGS) -c $(FCASA)casa_cable.f90
	$(FC) $(FFLAGS) -c $(FCASA)casa_inout.f90
	$(FC) $(FFLAGS) -c $(FDRIVERS)cable_driver.f90

	$(FC) -o $(PROG) cable_driver.o cable_data.o cable_read.o cable_write.o cable_initialise.o cable_cbm.o cable_common_module.o cable_diag.o cable_input.o cable_iovars.o cable_output.o cable_parameters.o cable_checks.o cable_canopy.o cable_roughness.o cable_radiation.o cable_albedo.o cable_air.o cable_soilsnow.o cable_carbon.o cable_abort.o cable_define_types.o cable_physical_constants.o cable_photosynthetic_constants.o cable_other_constants.o cable_math_constants.o cable_define_dimensions.o casa_variable.o casa_cable.o casa_cnp.o casa_inout.o -L$(NCDIR) -lnetcdf



$(PROGcomp): $(FDRIVERS)dev/cable_comp.F90
#	$(FC) $(FFLAGS) -c $(FCOMMON)cable_define_dimensions.F90
#	$(FC) $(FFLAGS) -c $(FCOMMON)cable_iovars.F90
#	$(FC) $(FFLAGS) -o cable_common_module.o -c $(FCOMMON)cable_common.F90
#	$(FC) $(FFLAGS) -c $(FCOMMON)cable_data.F90
#	$(FC) $(FFLAGS) -c $(FCOMMON)cable_diag.F90
	$(FC) $(FFLAGS) -c $(FSCIENCE)$(TGTCOMP).F90
	$(FC) $(FFLAGS) -c $(FDRIVERS)dev/cable_comp.F90

	$(FC) -o $(PROGcomp) cable_comp.o $(TGTCOMP).o cable_data.o cable_common_module.o cable_diag.o cable_iovars.o cable_define_dimensions.o -L$(NCDIR) -lnetcdf





$(PROGi90): $(FDRIVERS)cable_driver.f90
	rm -f netcdf.mod 
	ln -s $(NCMOD) ./netcdf.mod
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_define_dimensions.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_math_constants.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_other_constants.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_photosynthetic_constants.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_physical_constants.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_define_types.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_iovars.F90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_common.F90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_abort.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_parameters.f90
	$(FC) $(FFLAGS) -c -P $(FCOMMON)cable_diag.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_soilsnow.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_air.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_albedo.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_radiation.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_roughness.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_carbon.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_canopy.F90
	$(FC) $(FFLAGS) -c -P $(FSCIENCE)cable_cbm.F90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_checks.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_read.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_initialise.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_input.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_write.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_output.f90
	$(FC) $(FFLAGS) -c -P $(FCASA)casa_variable.f90
	$(FC) $(FFLAGS) -c -P $(FCASA)casa_cnp.f90
	$(FC) $(FFLAGS) -c -P $(FCASA)casa_cable.f90
	$(FC) $(FFLAGS) -c -P $(FCASA)casa_inout.f90
	$(FC) $(FFLAGS) -c -P $(FDRIVERS)cable_driver.f90 



clean:
	rm -f *.o *.mod 


