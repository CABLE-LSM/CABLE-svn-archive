<HTML> <BODY BGCOLOR=#eeeeff LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<a name='2'>
<font color=#447700>!========================================================================!<a name='3'></font>
<font color=#447700>!=== PURPOSE: to enable accessibility of fundamental vars in global   ===!<a name='4'></font>
<font color=#447700>!=== model thru out program (mainly CABLE).                           ===!<a name='5'></font>
<font color=#447700>!=== USE: use module in subroutines (SRs) at top level of global model===!<a name='6'></font>
<font color=#447700>!--- 2 define cable_timestep_ data with vars peculiar to global model ===!<a name='7'></font>
<font color=#447700>!=== optionally call alias_ SR to give name smore familiar to cable   ===!<a name='8'></font>
<font color=#447700>!=== people. then again use this module in  any subsequent SR in which===!<a name='9'></font>
<font color=#447700>!=== you want to access this data.                                    ===!  <a name='10'></font>
<font color=#447700>!========================================================================!<a name='11'></font>
<a name='12'>
<A NAME='CABLE_COMMON_MODULE'><A href='../../html_code/common/cable_common.F90.html#CABLE_COMMON_MODULE' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='13'>
<font color=#993300>module </font><font color=#cc0000>cable_common_module</font> <A href='../../call_to/CABLE_COMMON_MODULE.html' TARGET='index'>18</A><a name='14'>
   implicit none <a name='15'>
<a name='16'>
   <font color=#447700>!---allows reference to "gl"obal timestep in run (from atm_step)<a name='17'></font>
   <font color=#447700>!---total number of timesteps, and processing node <a name='18'></font>
   integer, save :: ktau_gl, kend_gl, knode_gl, kwidth_gl<a name='19'>
   <a name='20'>
   <font color=#447700>!---CABLE runtime switches def in this type<a name='21'></font>
   type kbl_internal_switches<a name='22'>
      logical :: um = .false., um_explicit = .false., um_implicit = .false., &amp;<a name='23'>
            um_radiation = .false., um_hydrology = .false.<a name='24'>
      logical :: offline = .false., mk3l = .false.<a name='25'>
   end type kbl_internal_switches <a name='26'>
<a name='27'>
   type (kbl_internal_switches), save :: cable_runtime<a name='28'>
<a name='29'>
   <font color=#447700>!---CABLE runtime switches def in this type<a name='30'></font>
   type kbl_user_switches<a name='31'>
      character(len=200) :: VEG_PARS_FILE <a name='32'>
      character(len=20) :: DIAG_SOIL_RESP <a name='33'>
      character(len=200) :: LEAF_RESPIRATION<a name='34'>
      character(len=200) :: FWSOIL_SWITCH <a name='35'>
      character(len=3) :: RUN_DIAG_LEVEL <a name='36'>
   end type kbl_user_switches<a name='37'>
<a name='38'>
   type (kbl_user_switches), save :: cable_user<a name='39'>
<a name='40'>
      type soilin_type<a name='41'>
         real, dimension(:),allocatable :: silt<a name='42'>
         real, dimension(:),allocatable :: clay<a name='43'>
         real, dimension(:),allocatable :: sand<a name='44'>
         real, dimension(:),allocatable :: swilt<a name='45'>
         real, dimension(:),allocatable :: sfc<a name='46'>
         real, dimension(:),allocatable :: ssat<a name='47'>
         real, dimension(:),allocatable :: bch<a name='48'>
         real, dimension(:),allocatable :: hyds<a name='49'>
         real, dimension(:),allocatable :: sucs<a name='50'>
         real, dimension(:),allocatable :: rhosoil<a name='51'>
         real, dimension(:),allocatable :: css<a name='52'>
         real, dimension(:),allocatable :: c3<a name='53'>
      end type soilin_type<a name='54'>
<a name='55'>
   type vegin_type<a name='56'>
      real, dimension(:),allocatable :: canst1<a name='57'>
      real, dimension(:),allocatable :: dleaf<a name='58'>
      real, dimension(:),allocatable :: vcmax<a name='59'>
      real, dimension(:),allocatable :: ejmax<a name='60'>
      real, dimension(:),allocatable :: hc<a name='61'>
      real, dimension(:),allocatable :: xfang<a name='62'>
      real, dimension(:),allocatable :: rp20<a name='63'>
      real, dimension(:),allocatable :: rpcoef<a name='64'>
      real, dimension(:),allocatable :: rs20<a name='65'>
      real, dimension(:),allocatable :: wai <a name='66'>
      real, dimension(:),allocatable :: rootbeta <a name='67'>
      real, dimension(:),allocatable :: shelrb<a name='68'>
      real, dimension(:),allocatable :: vegcf  <font color=#447700>!kdcorbin, 08/10<a name='69'></font>
      real, dimension(:),allocatable :: frac4<a name='70'>
      real, dimension(:,:),allocatable :: reflin<a name='71'>
      real, dimension(:,:),allocatable :: taulin<a name='72'>
      real, dimension(:),allocatable :: xalbnir<a name='73'>
      real, dimension(:),allocatable :: extkn <a name='74'>
      real, dimension(:,:),allocatable :: froot<a name='75'>
      real, dimension(:),allocatable :: tminvj<a name='76'>
      real, dimension(:),allocatable :: tmaxvj<a name='77'>
      real, dimension(:),allocatable :: vbeta<a name='78'>
      real, dimension(:,:),allocatable :: cplant<a name='79'>
      real, dimension(:,:),allocatable :: csoil<a name='80'>
      real, dimension(:,:),allocatable :: ratecp<a name='81'>
      real, dimension(:,:),allocatable :: ratecs<a name='82'>
   end type vegin_type<a name='83'>
<a name='84'>
   type(soilin_type) :: soilin<a name='85'>
   type(vegin_type)  :: vegin<a name='86'>
<a name='87'>
<A NAME='JHPRINT'><A href='../../html_code/common/cable_common.F90.html#JHPRINT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='88'>
   <font color=#993300>interface </font><font color=#cc0000>jhprint</font><a name='89'>
      module procedure<a name='90'>
   end interface jhprint<a name='91'>
<a name='92'>
<font color=#447700>!   !---parameters, tolerances, etc. could be set in _directives.h<a name='93'></font>
<font color=#447700>!   real, parameter :: RAD_TOLS = 1.0e-2<a name='94'></font>
<a name='95'>
<font color=#447700>!jhan:temporary measure. improve hiding<a name='96'></font>
<font color=#447700>!   real, dimension(:,:), pointer,save :: c1, rhoch<a name='97'></font>
      <a name='98'>
   contains<a name='99'>
<a name='100'>
<a name='101'>
<A NAME='GET_TYPE_PARAMETERS'><A href='../../html_code/common/cable_common.F90.html#GET_TYPE_PARAMETERS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='102'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_type_parameters</font>(logn,vegparmnew, classification),<A href='../../call_from/GET_TYPE_PARAMETERS.html' TARGET='index'>2</A><a name='103'>
      use <A href='../../html_code/common/cable_define_dimensions.F90.html#DEFINE_DIMENSIONS'>define_dimensions</A><A href='../../html_code/common/cable_common.F90.html#GET_TYPE_PARAMETERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEFINE_DIMENSIONS_1"><a name='104'>
      use <A href='../../html_code/common/cable_iovars.F90.html#IO_VARIABLES'>io_variables</A><A href='../../html_code/common/cable_common.F90.html#GET_TYPE_PARAMETERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IO_VARIABLES_1">, only : filename, soil_desc, veg_desc<a name='105'>
      implicit none<a name='106'>
      <font color=#447700>! Gets parameter values for each vegetation type and soil type.<a name='107'></font>
      INTEGER(i_d),INTENT(IN) :: logn     <font color=#447700>! log file unit number<a name='108'></font>
      <font color=#447700>!opt. arg neccessary in offline CABLE IO<a name='109'></font>
      character(len=4), intent(inout), optional :: classification<a name='110'>
      LOGICAL,INTENT(IN)      :: vegparmnew <font color=#447700>! new format input file (BP dec 2007)<a name='111'></font>
      CHARACTER(LEN=80) :: comments <a name='112'>
      CHARACTER(LEN=10) :: vegtypetmp                   <font color=#447700>! BP dec07<a name='113'></font>
      CHARACTER(LEN=25) :: vegnametmp                   <font color=#447700>! BP dec07<a name='114'></font>
      <font color=#447700>!character(LEN=25), dimension(:),allocatable :: veg_desc <a name='115'></font>
      INTEGER(i_d) :: jveg                              <font color=#447700>! BP dec07<a name='116'></font>
      REAL(r_1)    :: notused                           <font color=#447700>! BP dec07<a name='117'></font>
      INTEGER(i_d) :: ioerror <font color=#447700>! input error integer<a name='118'></font>
      INTEGER(i_d) :: a <font color=#447700>! do loop counter<a name='119'></font>
<a name='120'>
         <font color=#447700>!================= Read in vegetation type specifications: ============<a name='121'></font>
         OPEN(40,FILE=filename%veg,STATUS='old',ACTION='READ',IOSTAT=ioerror)<a name='122'>
            IF(ioerror/=0) then <a name='123'>
               print *, 'CABLE_log: Cannot open veg type definitions.'<a name='124'>
               stop<a name='125'>
            endif<a name='126'>
        <a name='127'>
            IF (vegparmnew) THEN<a name='128'>
               <font color=#447700>! assume using IGBP/CSIRO vegetation types<a name='129'></font>
               READ(40,*) comments<a name='130'>
               READ(40,*) mvtype<a name='131'>
               if( present(classification) ) &amp;<a name='132'>
                  WRITE(classification,'(a4)') comments(1:4)<a name='133'>
            ELSE<a name='134'>
               <font color=#447700>! assume using CASA vegetation types<a name='135'></font>
               <font color=#447700>!classification = 'CASA'<a name='136'></font>
               READ(40,*)<a name='137'>
               READ(40,*)<a name='138'>
               READ(40,*) mvtype <font color=#447700>! read # vegetation types<a name='139'></font>
               READ(40,*)<a name='140'>
               READ(40,*)<a name='141'>
               comments = 'CASA'<a name='142'>
            END IF<a name='143'>
            <a name='144'>
            WRITE(logn,'(A31,I3,1X,A10)') '  Number of vegetation types = ', mvtype, &amp;<a name='145'>
                 &amp;  TRIM(comments)<a name='146'>
        <a name='147'>
            <font color=#447700>! Allocate memory for type-specific vegetation parameters:<a name='148'></font>
            ALLOCATE ( vegin%canst1(mvtype),vegin%dleaf(mvtype), &amp;<a name='149'>
                 vegin%vcmax(mvtype),vegin%ejmax(mvtype),vegin%hc(mvtype), &amp;<a name='150'>
                 vegin%xfang(mvtype),vegin%rp20(mvtype),vegin%rpcoef(mvtype), &amp;<a name='151'>
                 vegin%rs20(mvtype),vegin%shelrb(mvtype),vegin%frac4(mvtype), &amp;<a name='152'>
                 vegin%wai(mvtype),vegin%vegcf(mvtype),vegin%extkn(mvtype), &amp;<a name='153'>
                 vegin%tminvj(mvtype),vegin%tmaxvj(mvtype),vegin%vbeta(mvtype), &amp;<a name='154'>
                 vegin%rootbeta(mvtype),vegin%froot(ms,mvtype), &amp;<a name='155'>
                 vegin%cplant(ncp,mvtype),vegin%csoil(ncs,mvtype), &amp;<a name='156'>
                 vegin%ratecp(ncp,mvtype),vegin%ratecs(ncs,mvtype), &amp;<a name='157'>
                 vegin%xalbnir(mvtype),vegin%taulin(nrb,mvtype), &amp;<a name='158'>
                 vegin%reflin(nrb,mvtype), veg_desc(mvtype) ) <a name='159'>
        <a name='160'>
            IF (vegparmnew) THEN    <font color=#447700>! added to read new format (BP dec 2007)<a name='161'></font>
               <a name='162'>
               <font color=#447700>! Read in parameter values for each vegetation type:<a name='163'></font>
               DO a = 1,mvtype <a name='164'>
                  READ(40,*) jveg, vegtypetmp, vegnametmp<a name='165'>
                    <a name='166'>
                     IF (jveg .GT. mvtype) then<a name='167'>
                        write(6,*) 'jveg out of range in parameter file'<a name='168'>
                        STOP <a name='169'>
                     endif   <a name='170'>
                     veg_desc(jveg) = vegnametmp <a name='171'>
                  <a name='172'>
                  <font color=#447700>!jhan:UM<a name='173'></font>
                  if(cable_runtime%um) then <a name='174'>
                     READ(40,*) vegin%hc(jveg), vegin%xfang(jveg), notused,  &amp;<a name='175'>
                           &amp;   vegin%dleaf(jveg), vegin%frac4(jveg)<a name='176'>
                  else   <a name='177'>
                     READ(40,*) vegin%hc(jveg), vegin%xfang(jveg), notused, vegin%dleaf(jveg)<a name='178'>
                  endif<a name='179'>
                  READ(40,*) vegin%reflin(1:3,jveg) <font color=#447700>! rhowood not used ! BP may2011<a name='180'></font>
                  READ(40,*) vegin%taulin(1:3,jveg) <font color=#447700>! tauwood not used ! BP may2011<a name='181'></font>
                  READ(40,*) notused, notused, notused, vegin%xalbnir(jveg)<a name='182'>
                  READ(40,*) notused, vegin%wai(jveg), vegin%canst1(jveg), &amp;<a name='183'>
                     vegin%shelrb(jveg), vegin%vegcf(jveg), vegin%extkn(jveg)<a name='184'>
                  READ(40,*) vegin%vcmax(jveg), vegin%rp20(jveg), &amp;<a name='185'>
                             vegin%rpcoef(jveg), &amp;<a name='186'>
                             vegin%rs20(jveg)<a name='187'>
                  READ(40,*) vegin%tminvj(jveg), vegin%tmaxvj(jveg), &amp;<a name='188'>
                             vegin%vbeta(jveg), vegin%rootbeta(jveg)<a name='189'>
                  READ(40,*) vegin%cplant(1:3,jveg), vegin%csoil(1:2,jveg)<a name='190'>
                  <font color=#447700>! rates not currently set to vary with veg type<a name='191'></font>
                  READ(40,*) vegin%ratecp(1:3,jveg), vegin%ratecs(1:2,jveg)<a name='192'>
              END DO<a name='193'>
<a name='194'>
            ELSE<a name='195'>
   <a name='196'>
               DO a = 1,mvtype <a name='197'>
                  READ(40,'(8X,A70)') veg_desc(a) <font color=#447700>! Read description of each veg type<a name='198'></font>
               END DO<a name='199'>
   <a name='200'>
               READ(40,*); READ(40,*) <a name='201'>
               READ(40,*) vegin%canst1<a name='202'>
               READ(40,*) <a name='203'>
               READ(40,*) vegin%dleaf<a name='204'>
               READ(40,*) vegin%vcmax<a name='205'>
               READ(40,*) vegin%hc<a name='206'>
               READ(40,*) vegin%xfang<a name='207'>
               READ(40,*) vegin%rp20<a name='208'>
               READ(40,*) vegin%rpcoef<a name='209'>
               READ(40,*) vegin%rs20<a name='210'>
               READ(40,*) vegin%shelrb<a name='211'>
               READ(40,*) vegin%frac4<a name='212'>
               READ(40,*) vegin%wai<a name='213'>
               READ(40,*) vegin%vegcf<a name='214'>
               READ(40,*) vegin%extkn<a name='215'>
               READ(40,*) vegin%tminvj<a name='216'>
               READ(40,*) vegin%tmaxvj<a name='217'>
               READ(40,*) vegin%vbeta<a name='218'>
               READ(40,*) vegin%xalbnir<a name='219'>
               READ(40,*) vegin%rootbeta<a name='220'>
               READ(40,*) vegin%cplant(1,:)<a name='221'>
               READ(40,*) vegin%cplant(2,:)<a name='222'>
               READ(40,*) vegin%cplant(3,:)<a name='223'>
               READ(40,*) vegin%csoil(1,:)<a name='224'>
               READ(40,*) vegin%csoil(2,:)<a name='225'>
               READ(40,*) <a name='226'>
               READ(40,*) vegin%ratecp(:,1)<a name='227'>
               <font color=#447700>! Set ratecp to be the same for all veg types:<a name='228'></font>
               vegin%ratecp(1,:)=vegin%ratecp(1,1)<a name='229'>
               vegin%ratecp(2,:)=vegin%ratecp(2,1)<a name='230'>
               vegin%ratecp(3,:)=vegin%ratecp(3,1)<a name='231'>
               READ(40,*) <a name='232'>
               READ(40,*) vegin%ratecs(:,1)<a name='233'>
               vegin%ratecs(1,:)=vegin%ratecs(1,1)<a name='234'>
               vegin%ratecs(2,:)=vegin%ratecs(2,1)<a name='235'>
               <font color=#447700>! old table does not have taul and refl ! BP may2011<a name='236'></font>
               vegin%taulin(1,:) = 0.07<a name='237'>
               vegin%taulin(2,:) = 0.425<a name='238'>
               vegin%taulin(3,:) = 0.0<a name='239'>
               vegin%reflin(1,:) = 0.07<a name='240'>
               vegin%reflin(2,:) = 0.425<a name='241'>
               vegin%reflin(3,:) = 0.0<a name='242'>
   <a name='243'>
            ENDIF<a name='244'>
   <a name='245'>
            write(6,*)'CABLE_log:Closing veg params file: ',trim(filename%veg)<a name='246'>
         CLOSE(40)<a name='247'>
   <a name='248'>
        <font color=#447700>!================= Read in soil type specifications: ============<a name='249'></font>
         OPEN(40,FILE=filename%soil,STATUS='old',ACTION='READ',IOSTAT=ioerror)<a name='250'>
            IF(ioerror/=0) then <a name='251'>
              print *, 'CABLE_log: Cannot open soil type definitions.'<a name='252'>
              stop<a name='253'>
            endif<a name='254'>
   <a name='255'>
            READ(40,*); READ(40,*)<a name='256'>
            READ(40,*) mstype <font color=#447700>! Number of soil types<a name='257'></font>
            READ(40,*); READ(40,*)<a name='258'>
        <a name='259'>
            ALLOCATE ( soil_desc(mstype) )<a name='260'>
            ALLOCATE ( soilin%silt(mstype), soilin%clay(mstype), soilin%sand(mstype) )<a name='261'>
            ALLOCATE ( soilin%swilt(mstype), soilin%sfc(mstype), soilin%ssat(mstype) )<a name='262'>
            ALLOCATE ( soilin%bch(mstype), soilin%hyds(mstype), soilin%sucs(mstype) )<a name='263'>
            ALLOCATE ( soilin%rhosoil(mstype), soilin%css(mstype) )<a name='264'>
        <a name='265'>
            DO a = 1,mstype <a name='266'>
               READ(40,'(8X,A70)') soil_desc(a) <font color=#447700>! Read description of each soil type<a name='267'></font>
            END DO<a name='268'>
   <a name='269'>
            READ(40,*); READ(40,*) <a name='270'>
            READ(40,*) soilin%silt<a name='271'>
            READ(40,*) soilin%clay<a name='272'>
            READ(40,*) soilin%sand<a name='273'>
            READ(40,*) soilin%swilt<a name='274'>
            READ(40,*) soilin%sfc<a name='275'>
            READ(40,*) soilin%ssat<a name='276'>
            READ(40,*) soilin%bch<a name='277'>
            READ(40,*) soilin%hyds<a name='278'>
            READ(40,*) soilin%sucs<a name='279'>
            READ(40,*) soilin%rhosoil<a name='280'>
            READ(40,*) soilin%css<a name='281'>
      CLOSE(40)<a name='282'>
<a name='283'>
      return<a name='284'>
   END SUBROUTINE get_type_parameters<a name='285'>
<a name='286'>
<a name='287'>
<a name='288'>
end module cable_common_module<a name='289'>
<a name='290'>
</pre></body></html>