#!/bin/csh

#start afresh
make -f Make_CABLE-UM clean

make -f Make_CABLE-UM cable
if (-f cable_explicit_driver.o) then
   echo ''
   echo 'compile successful. now build library'
   echo ''
else
   echo ''
   echo 'compile failed'
   exit
endif

if (-d tmp) then
   rm -fr tmp
endif   
mkdir tmp
mv *.o *.mod tmp

## make library from CABLE object files
if (-f tmp/cable_explicit_driver.o) then
   cd tmp/
      #./makelib.csh   
      ar r libcable.a cable_explicit_driver.o cable_implicit_driver.o   \
         cable_rad_driver.o cable_hyd_driver.o cable_common_module.o    \
         cable_diag.o cable_define_dimensions.o cable_math_constants.o  \
         cable_other_constants.o cable_photosynthetic_constants.o       \
         cable_physical_constants.o cable_define_types.o cable_iovars.o \
         cable_soilsnow.o cable_air.o cable_albedo.o cable_radiation.o  \
         cable_roughness.o cable_carbon.o cable_canopy.o cable_cbm.o    \
         cable_um_tech.o cable_um_init_subrs.o cable_um_init.o 

      if (-f libcable.a) then
         echo ''
         echo 'library build successful. copying to ~/CABLE-UM'
         echo ''
      else
         echo ''
         echo 'build failed'
         exit
      endif
   cd ../
else
   exit
endif

cd lib/
   if (-f libcable.a) then
      mv libcable.a libcable.a.bu 
   endif   
   /bin/cp ../tmp/libcable.a .

   if (-d ~/CABLE-UM) then
      rm -f ~/CABLE-UM/libcable.a
      /bin/cp ../tmp/libcable.a ~/CABLE-UM
   else
      mkdir ~/CABLE-UM 
      /bin/cp ../tmp/libcable.a ~/CABLE-UM
   endif   

   if (-f ~/CABLE-UM/libcable.a) then
      echo ''
      echo `ls -alt ~/CABLE-UM/libcable.a`
      echo ''
      echo 'DONE'
      rm -fr tmp/
      exit
   else
      echo 'build failed'
      exit
   endif

