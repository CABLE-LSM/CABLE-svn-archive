## this Makefile builds the CABLE executable from f90 source code 


##user section

##########################################################################
## this first section needs to be configured by the user depending 
## on the build platform, specifically compiler, location of netcdf 
## headers and libraries 
##########################################################################

## vayu.nci.org.au
FC = ifort
NCDIR = /apps/netcdf/3.6.3/lib/Intel
NCMOD = /apps/netcdf/3.6.3/include/Intel/
#ifort compiler options
FFLAGS = -O2 -fp-model precise -ftz -fpe0
#FFLAGS = -O0 -traceback -g -fp-model precise -ftz -fpe0 -I$(NCMOD) 

## shine-cl
#FC = ifort
#NCDIR = /usr/local/intel/lib/            # netcdf library address on shine-cl
#NCMOD = /usr/local/intel/include/                    # on shine-cl
## ifort compiler options
#FFLAGS = -O2 -fp-model precise -ftz -fpe0
#FFLAGS = -O0 -traceback -g -fp-model precise -ftz -fpe0 -I$(NCMOD) 

#zjlnik: jxs599 Mac
#FC = gfortran                    
#FC = gfortran  -ffree-line-length-132
#NCDIR = /usr/local/lib/            # netcdf library address on zjlmik 
#NCMOD = /usr/local/include/ncdf/ #netcdf.mod
## gfortran compiler options
#FFLAGS = -O0 -x f95-cpp-input -v -g3 -I$(NCMOD) 
#FFLAGS = -O0 -x f95-cpp-input -I$(NCMOD) 



##########################################################################
##########################################################################

##END user section

SHELL = /bin/sh


# these are all the files we are compiling
LSRC = cable_define_dimensions.F90 cable_math_constants.F90 cable_other_constants.F90 cable_photosynthetic_constants.F90 cable_physical_constants.F90 cable_common.F90 cable_define_types.F90 cable_iovars.F90 cable_abort.F90 casa_variable.F90 cable_parameters.F90 cable_diag.F90 cable_soilsnow.F90 cable_air.F90 cable_albedo.F90 cable_radiation.F90 cable_roughness.F90 cable_carbon.F90 cable_canopy.F90 cable_cbm.F90 cable_checks.F90 cable_read.F90 cable_initialise.F90 cable_input.F90 cable_write.F90 cable_output.F90 casa_cnp.F90 casa_cable.F90 casa_inout.F90 cable_driver.F90 

# this is the executable we are building
PROG = cable


FINC = -I$(NCMOD)
LD =  -L$(NCDIR) -lnetcdf 

OBJS	= ${LSRC:.F90=.o} 

#suffixes we use
.SUFFIXES:.F90 
#default rules for these suffixes
.F90.o:
	$(FC) $(FFLAGS) $(FINC) -c $<

# default target by convention is ``all''
all : $(PROG)

#build PROG (cable executable) by linking all objects
#$(PROG) : $(OBJS)
$(PROG) : cable_driver.o 
	$(FC) $(FFLAGS) -o $@ $(OBJS) $(LD) 


# dependencies
#these build anyway, courtesy of above use of .SUFFIXES etc AND they have NO dependencies
cable_abort.o: cable_abort.F90
cable_iovars.o: cable_iovars.F90
cable_read.o: cable_read.F90
cable_read.o: cable_read.F90
cable_write.o: cable_write.F90
cable_initialise.o: cable_initialise.F90

cable_diag.o: cable_diag.F90

cable_define_dimensions.o: cable_define_dimensions.F90

cable_math_constants.o: cable_math_constants.F90 cable_define_dimensions.o
cable_other_constants.o: cable_other_constants.F90 cable_define_dimensions.o
cable_physical_constants.o: cable_physical_constants.F90 cable_define_dimensions.o
cable_photosynthetic_constants.o: cable_photosynthetic_constants.F90 cable_define_dimensions.o


cable_define_types.o: cable_define_types.F90 cable_define_dimensions.o cable_physical_constants.o 

cable_output.o: cable_output.F90 cable_input.o cable_write.o
cable_input.o: cable_input.F90 cable_checks.o cable_abort.o cable_canopy.o cable_physical_constants.o cable_parameters.o cable_read.o cable_initialise.o
cable_common.o: cable_common.F90 cable_define_dimensions.o cable_iovars.o 

cable_checks.o: cable_checks.F90 cable_canopy.o cable_define_types.o cable_physical_constants.o

cable_parameters.o: cable_parameters.F90 cable_define_types.o cable_abort.o casa_variable.o

cable_carbon.o: cable_carbon.F90 cable_define_types.o

cable_air.o: cable_air.F90 cable_define_types.o cable_physical_constants.o

cable_albedo.o: cable_albedo.F90 cable_define_types.o cable_physical_constants.o cable_other_constants.o cable_math_constants.o

cable_canopy.o: cable_canopy.F90 cable_define_types.o cable_physical_constants.o cable_photosynthetic_constants.o cable_radiation.o cable_roughness.o cable_air.o


cable_cbm.o: cable_cbm.F90 cable_carbon.o cable_soilsnow.o cable_parameters.o cable_canopy.o cable_define_types.o cable_physical_constants.o cable_roughness.o cable_radiation.o cable_albedo.o

cable_roughness.o: cable_roughness.F90 cable_define_types.o cable_physical_constants.o

cable_soilsnow.o: cable_soilsnow.F90 cable_physical_constants.o cable_define_types.o

cable_radiation.o: cable_radiation.F90 cable_define_types.o cable_physical_constants.o cable_math_constants.o cable_other_constants.o cable_common.o cable_diag.o 

cable_driver.o: cable_driver.F90 cable_output.o cable_parameters.o cable_cbm.o casa_cnp.o casa_cable.o casa_inout.o

casa_cnp.o: casa_cnp.F90 
casa_cable.o: casa_cable.F90 
casa_inout.o: casa_inout.F90 
casa_variable.o: casa_variable.F90
 
#cable_define_types.F90 cable_define_dimensions.o
clean:
	rm -f *.o *.mod 

