#!/bin/csh

# make CABLE
make -f Makefiles/Make_CABLE-UM cable
if (-d tmp) then
   rm -fr tmp
endif   
mkdir tmp
mv *.o *.mod tmp

## make library from CABLE object files
if (-f tmp/cable_explicit_driver.o) then
   cp  Makefiles/makelib.csh tmp
   pushd tmp/
      ./makelib.csh   
   popd
else
   exit
endif

pushd lib/
   if (-f libcable.a) then
      mv libcable.a libcable.a.bu 
   endif   
   mv ../tmp/libcable.a .
   #temp. USEing cable_common_module at top_level
   mv ../tmp/cable_common_module.mod .
   mv ../tmp/cable_common_module.o .
popd
rm -fr tmp/

# build UM with new CABLE library
#pushd ~/UM_ROUTDIR/jxs599/laaaf/
#   ./bld.csh
#popd
#
#clear
#ls -alt ~/CABLE_standalone/lib/libcable.a
#echo ''
#
#ls -alt ~/UM_ROUTDIR/jxs599/laaaf/ummodel/bin/laaaf.exe
#echo ''
#
### prepare and run UM manually
#pushd ~/umui_runs
#
#   ## rm existing jobscripts
#   if (-d laaaf-117125231) then
#      rm -fr laaaf-117125231/
#   endif
#   
#   ## copy jobscripts
#   /bin/cp -r Elaaaf-117125231/ laaaf-117125231
#   cd laaaf-117125231
#   
#   ## rm existing testing output 
#   if (-f ~/UM_ROUTDIR/laaaf/canopy_flux00.bin) then
#      rm -fr ~/UM_ROUTDIR/laaaf/can*
#   endif
#
#   ## run UM manually
#   ./FCM_MAIN_SCR
###    ./umui_submitrun
#popd
