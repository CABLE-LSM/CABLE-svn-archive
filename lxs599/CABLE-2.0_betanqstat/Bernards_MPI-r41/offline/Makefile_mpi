# Makefile for offline CABLE-MPI LSM.
# Usage: "make -fMakefile_mpi" (same as "make -fMakefile_mpi netcdf")
#     or "make -fMakefile_mpi text"
# Gab Abramowitz - gabsun@gmail.com    - 2007
# Bernard Pak added platform choices for CSIRO users - 2008
# Also added casaCNP - 2010
# Maciej Golebiewski added MPI-specific changes
# Bugs and queries to Bernard.Pak@csiro.au

PROG = cable-mpi

###################################################################
# Here are the main things users need to choose for themselves:
#FC = /opt/SUNWspro/bin/f95    # compiler for sol-as
#FC = ifort                    # compiler on systems using SGI MPT implementation of MPI
FC = mpif90          # compiler on systems using OpenMPI
#FC = g95

NCDIR = $(NETCDF_ROOT)/lib
NCMOD = $(NETCDF_ROOT)/include

# g95 -fbounds-check -ftrace=full -Wall -O2
# ifort -fpstkchk -C    # -o0 through -o4
#FFLAGS = -O0 -I $(NCMOD)
FFLAGS = -O2 -fp-model precise -I $(NCMOD) -I .
#FFLAGS = -O0 -fp-model precise -g -I $(NCMOD) -I . -debug all -traceback
#FFLAGS = -g -O0 -traceback -debug all -I $(NCMOD)  # for debugging

# End of user changes (usually)
###################################################################

.SUFFIXES:
.SUFFIXES: .F90 .o
.F90.o:
	$(FC) $(FFLAGS) -c $<

$(PROG): cable_mpidrv.o 
	$(FC) $(FFLAGS) -o $(PROG) cable_mpidrv.o cable_mpicommon.o cable_mpimaster.o cable_mpiworker.o \
		cable_iovars.o cable_abort.o cable_air.o cable_roughness.o cable_albedo.o cable_radiation.o cable_canopy.o cable_cbm.o cable_read.o cable_write.o cable_initialise.o cable_input.o cable_output.o cable_parameters.o cable_checks.o cable_define_types.o cable_soilsnow.o cable_carbon.o  casa_variable.o casa_cable.o casa_cnp.o casa_inout.o cable_common.o cable_data.o  \
		-L$(NCDIR) -lnetcdff -lnetcdf
# add -lmpi if FC=ifort and using SGI MPT

#cable_txt: cable_drivertxt.o 
#	$(FC) $(FFLAGS) -o cable_txt cable_drivertxt.o cable_cbm.o cable_checks.o cable_outputtxt.o cable_parameters.o cable_variables.o cable_soilsnow.o cable_carbon.o  casa_variable.o casa_cable.o casa_cnp.o casa_inout.o

clean:
	rm -f *.o $(PROG) cable_txt *.mod

# dependencies
cable_abort.o: cable_abort.F90 cable_iovars.o cable_define_types.o

cable_data.o: cable_data.F90 
 
cable_air.o: cable_air.F90 cable_define_types.o cable_common.o cable_data.o

cable_albedo.o: cable_albedo.F90 cable_define_types.o cable_common.o cable_data.o

cable_canopy.o: cable_canopy.F90 cable_define_types.o cable_radiation.o cable_air.o cable_common.o cable_data.o

cable_carbon.o: cable_carbon.F90 cable_define_types.o cable_common.o cable_data.o

cable_cbm.o: cable_cbm.F90 cable_carbon.o cable_soilsnow.o cable_canopy.o cable_define_types.o cable_roughness.o cable_radiation.o cable_albedo.o casa_variable.o cable_common.o cable_data.o

cable_checks.o: cable_checks.F90 cable_radiation.o cable_common.o

cable_driver.o: cable_driver.F90 cable_output.o cable_iovars.o cable_cbm.o  casa_variable.o casa_cable.o casa_cnp.o casa_inout.o cable_input.o cable_common.o cable_data.o

cable_define_types.o: cable_define_types.F90

cable_iovars.o: cable_iovars.F90 cable_define_types.o

cable_read.o: cable_read.F90 cable_iovars.o cable_abort.o cable_define_types.o

cable_initialise.o: cable_initialise.F90 cable_read.o cable_iovars.o cable_abort.o  cable_define_types.o

cable_write.o: cable_write.F90 cable_iovars.o cable_abort.o cable_define_types.o 

cable_input.o: cable_input.F90 cable_checks.o cable_abort.o cable_read.o cable_initialise.o cable_radiation.o cable_parameters.o cable_common.o casa_variable.o

cable_output.o: cable_output.F90 cable_checks.o cable_write.o cable_common.o

#cable_outputtxt.o: cable_outputtxt.F90 cable_checks.o cable_carbon.o

cable_parameters.o: cable_parameters.F90 cable_define_types.o cable_iovars.o cable_abort.o casa_variable.o cable_common.o

cable_radiation.o: cable_radiation.F90 cable_define_types.o cable_common.o cable_data.o 

cable_roughness.o: cable_roughness.F90 cable_define_types.o cable_common.o cable_data.o

cable_soilsnow.o: cable_soilsnow.F90 cable_iovars.o cable_define_types.o cable_common.o cable_data.o

casa_variable.o: casa_variable.F90 cable_define_types.o

casa_cable.o: casa_cable.F90 cable_define_types.o  cable_carbon.o casa_variable.o 

casa_cnp.o: casa_cnp.F90 cable_define_types.o  casa_variable.o 

casa_inout.o: casa_inout.F90 cable_define_types.o  cable_iovars.o casa_variable.o casa_cnp.o

cable_mpicommon.o: cable_mpicommon.F90  cable_iovars.o cable_define_types.o

cable_mpimaster.o: cable_mpimaster.F90 cable_mpicommon.o cable_output.o cable_iovars.o cable_cbm.o  casa_variable.o casa_cable.o casa_cnp.o casa_inout.o cable_input.o cable_define_types.o  cable_common.o

cable_mpiworker.o: cable_mpiworker.F90 cable_mpicommon.o cable_output.o cable_iovars.o cable_cbm.o  casa_variable.o casa_cable.o casa_cnp.o casa_inout.o cable_input.o cable_define_types.o  cable_common.o

cable_mpidrv.o: cable_mpidrv.F90 cable_mpicommon.o cable_mpimaster.o cable_mpiworker.o

cable_common.o: cable_common.F90  cable_iovars.o cable_define_types.o




